# セットリスト順番支援ツール 要件定義書（v1.1）
更新日: 2026-02-03  
公開: GitHub Pages（Public repo / 標準ドメイン）  
対象: OpenCode（ターミナル型AIエージェント）による実装

---

## 1. 目的・背景
音楽ライブのセットリスト（曲順）を検討する際に、複数案の管理、曲順の並べ替え、曲以外の要素（MC/幕間/区切り等）を含めた構成調整を効率化する補助ツールを提供する。

---

## 2. 想定利用者・利用シーン
- 一般公開（誰でもアクセス可能）
- アクセス規模: 数名程度想定
- 主な利用端末: PCメイン（モバイルでも利用できるレスポンシブ対応）

---

## 3. 前提・制約
- GitHub Pagesで配信する静的Webアプリ（サーバー処理なし）
- 外部DB/専用ストレージは使用しない
- 保存は端末内のみ（ブラウザに残ればOK）
- 認証なし
- 解析ツール導入なし
- 表示言語: 日本語のみ

---

## 4. 非機能要件
### 4.1 対応環境
- 最新の Chrome / Edge / Safari
- iOS Safari を含む（モバイルでの閲覧・操作が可能）

### 4.2 セキュリティ・プライバシー
- 個人情報・機微情報を扱わない
- 外部へのデータ送信を行わない（外部API呼び出しなし）
- secrets をフロントに埋め込まない

### 4.3 永続化
- 端末内保存: IndexedDB（推奨）
- localStorageは軽量な設定用途に限定（必要な場合のみ）

---

## 5. 用語
- セットリスト: 1案（1公演/1構成案）の曲順リスト。タイトルを持ち、複数保存できる。
- セットリスト項目（行）: セットリスト上の1行。曲だけでなくメモ行や区切り行を含む。
- 楽曲ライブラリ: CSV等で取り込む楽曲リスト。セットリストへ選択追加できる。

---

## 6. 機能要件

### 6.1 セットリスト管理
- セットリストを複数作成・保存できる
- セットリストにタイトルを付けられる
- セットリストを複製（コピー）して別案として保存できる
- セットリストを削除できる（確認あり）
- JSONインポートでセットリストを取り込める（上書きせず新規として保存）

### 6.2 セットリスト項目（行）仕様
#### 6.2.1 行種別
- `SONG`: 曲
- `NOTE`: 曲以外の自由枠（MC/幕間/ダブルアンコール/演出/注意事項など）
- `ENCORE_START`: アンコール開始の区切り（最大1つ）

#### 6.2.2 行の並べ替え
- ドラッグ&ドロップで並べ替えできる
- 行の「上へ」「下へ」ボタンでも並べ替えできる

#### 6.2.3 行の追加
- 曲（SONG）を追加できる（空欄のまま追加可）
- NOTEを追加できる
- ENCORE_STARTを追加できる（既に存在する場合は追加不可）

### 6.3 入力項目
#### 6.3.1 SONG（曲）
- 曲名（title）: 任意（空欄可）
- アーティスト（artist）: 任意（空欄可）
- メモ（memo）: 任意 **（複数行改行可）**

#### 6.3.2 NOTE（自由枠）
- ラベル（label）: 任意（例: MC / 幕間 / Wアンコール / 映像）
- 本文（text）: 任意 **（複数行改行可）**

#### 6.3.3 ENCORE_START（区切り）
- 表示は固定（例: "Encore" / "アンコール開始"）
- メモ（memo）: 任意（複数行でも可としてよい）

### 6.4 曲の追加方法
- 手入力でSONGを追加・編集できる
- 楽曲ライブラリから曲を選択してSONGに反映できる（title/artist等）
- 「空欄の曲行」を先に追加でき、後から入力/選択で埋められる

---

## 7. 採番・集計ルール

### 7.1 採番対象
- 採番するのは `SONG` 行のみ

### 7.2 採番形式
- ENCORE_STARTより前のSONG: `M01`, `M02`, ...
- ENCORE_STARTより後のSONG: `EN01`, `EN02`, ...
- ENCORE_STARTが無い場合: 全て `Mxx`

### 7.3 採番の再計算
- 並べ替え/追加/削除のたびに採番を自動で振り直す

### 7.4 曲数表示
セットリスト編集画面のヘッダ等に表示:
- 本編曲数（M曲数）
- アンコール曲数（EN曲数）
- 合計曲数（M+EN）

※NOTE/ENCORE_STARTは曲数に含めない

---

## 8. 楽曲ライブラリ要件

### 8.1 ライブラリ保持項目
- 曲名（title）
- アーティスト（artist）
- コメント（comment）
- URL（url）

### 8.2 CSVインポート（必須）
- CSVの列: `title,artist,comment,url`
- ヘッダあり推奨
- 文字コード: UTF-8（BOMあり/なし対応が望ましい）
- 行の前後空白はtrim
- titleが空の行はスキップ
- 余分な列は無視

### 8.3 重複ルール（確定）
- 重複判定キー: `title + artist` の完全一致
- 同一キーが既に存在する場合: スキップ
- 同じtitleでもartistが違えば: 追加する

### 8.4 検索
- 曲名/アーティストで部分一致検索できる（最低限）

---

## 9. 出力・共有（エクスポート/インポート）

### 9.1 コピー用テキスト出力（必須）
- セットリストをコピーしやすい体裁で表示し、「コピー」ボタンでクリップボードへコピーできる
- NOTE.text と SONG.memo は改行を保持する
- 複数行のメモ/本文は、次行以降をインデントして視認性を確保する（例: 2スペース）

出力例（イメージ）:
- タイトル
- M01 曲名 - アーティスト
  - メモ1行目
  - メモ2行目
- [MC] 本文1行目
  本文2行目
- Encore
- EN01 曲名 - アーティスト

### 9.2 セットリストJSONエクスポート/インポート（必須）
- エクスポート: JSONファイルとしてダウンロードできる
- インポート: JSONファイルを選択して取り込み、新規セットリストとして保存（既存上書きなし）

### 9.3 PNG画像出力（必須）
- 共有専用レイアウト（白背景・大きめ文字）でPNG出力できる
- 画像にはタイトル・採番済みリスト・NOTE・Encore区切りを含める
- NOTE.text と SONG.memo は折り返し・改行表示に対応する
- 長文の場合は縦方向に伸長してよい

---

## 10. データ設計（端末内）
### 10.1 ストレージ
- IndexedDB（推奨）
  - `songLibrary`（楽曲ライブラリ）
  - `setlists`（セットリスト）

### 10.2 データ構造（案）
#### SongLibraryItem
- id: string (uuid)
- title: string
- artist: string
- comment: string
- url: string
- createdAt: string (ISO8601)
- updatedAt: string (ISO8601)

#### Setlist
- id: string (uuid)
- title: string
- items: SetlistItem[]
- createdAt: string (ISO8601)
- updatedAt: string (ISO8601)

#### SetlistItem
- id: string (uuid)
- type: "SONG" | "NOTE" | "ENCORE_START"
- SONG:
  - title?: string
  - artist?: string
  - memo?: string  // 改行を含む
- NOTE:
  - label: string
  - text?: string  // 改行を含む
- ENCORE_START:
  - memo?: string

---

## 11. JSON仕様（セットリスト共有 v1）
### 11.1 ルート
- schemaVersion: "setlist-assist.v1"
- exportedAt: string (ISO8601)
- setlist: Setlist

※インポート時、idは再採番してもよい（新規セットリストとして保存するため）

---

## 12. 画面要件

### 12.1 ホーム（セットリスト一覧）
- 一覧: タイトル、曲数（M/EN/Total）、更新日時
- 操作:
  - 新規作成
  - 編集
  - 複製
  - 削除（確認）
  - JSONインポート（セットリスト）
  - 楽曲ライブラリへ移動

### 12.2 セットリスト編集
- タイトル編集
- 曲数表示（M/EN/Total）
- 行一覧（D&D + 上下ボタン）
- 行追加:
  - 曲追加（空欄可）
  - NOTE追加
  - Encore区切り追加（1つまで）
- 行編集:
  - SONG: title/artist（1行入力）, memo（textarea）
  - NOTE: label（1行入力）, text（textarea）
- 出力/共有画面へ移動

### 12.3 楽曲ライブラリ
- 検索（title/artist）
- CSVインポート
- 一覧表示（title/artist/comment/url）

### 12.4 出力/共有
- コピー用テキスト表示 + コピー
- JSONエクスポート（ダウンロード）
- JSONインポート
- PNG出力（共有専用レイアウト）

---

## 13. 受け入れ基準（主要）
- 並べ替え:
  - D&Dで順序が変わり保存される
  - 上下ボタンでも同様に保存される
- 採番:
  - Encore区切り前はMxx、後はENxxに自動振り直し
- NOTE自由入力:
  - label/textが自由入力でき、順番内で移動できる
  - NOTE.textは改行保持
- SONGメモ:
  - memoは改行保持
- CSV重複:
  - title+artist一致はスキップ
  - title同一でもartistが違えば追加
- JSON:
  - エクスポート→別環境でインポートして内容が再現できる
- PNG:
  - 共有レイアウトでタイトル・採番・NOTEが読みやすいPNGが生成できる

---

## 14. 技術要件（推奨実装）
- Vite + React + TypeScript
- IndexedDB: Dexie（推奨）
- D&D: dnd-kit（推奨）
- PNG生成: html-to-image または同等ライブラリ
- GitHub ActionsでPagesデプロイ（main push）

---

## 15. OpenCode向け実装チケット
- T-01 雛形作成（Vite/React/TS）、ルーティング、ベースUI、Pagesデプロイ基盤
- T-02 IndexedDBスキーマ + CRUD（setlists/songLibrary）
- T-03 セットリスト一覧（新規/編集/複製/削除/インポート）
- T-04 編集画面（インライン編集、NOTE/ENCORE、textarea改行対応）
- T-05 並べ替え（D&D + 上下ボタン）+ 永続化
- T-06 採番・曲数集計（M/EN/Total）
- T-07 楽曲ライブラリ（検索、CSVインポート、重複スキップ）
- T-08 曲追加（手入力/ライブラリ選択/空欄行追加）
- T-09 出力/共有（コピー用テキスト、JSON export/import）
- T-10 PNG出力（共有専用レイアウト）
- T-11 README整備（開発手順、CSV/JSON仕様、運用）

---
